<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de Delays</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    label { display: block; margin-top: 10px; }
    input, select, textarea { width: 100%; padding: 8px; margin-top: 5px; }
    .alerta { color: red; font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Registro de Delays</h2>
  <div id="alertaTurno" class="alerta"></div>

  <form id="delayForm">
    <label>Fecha</label>
    <input type="date" id="fecha" name="fecha" required>

    <label>Área afectada</label>
    <select name="area" required>
      <option value="">Seleccionar</option>
      <option value="IMF">Horno de Inducción (IMF)</option>
      <option value="CCM">Máquina de Colada Continua (CCM)</option>
      <option value="PCH">Patio de Chatarra (PCH)</option>
      <option value="CRA">Grúa (CRA)</option>
      <option value="TUN">Área de Tundish (TUN)</option>
      <option value="LAD">Cuchara (LAD)</option>
      <option value="PUMP">Casa de Bombas (PUMP)</option>
      <option value="EX">Extracción de Humos (EX)</option>
      <option value="TRA">Transformador (TRA)</option>
      <option value="ANDE">ANDE</option>
      <option value="O2">Oxígeno (O2)</option>
      <option value="QC">Control de Calidad (QC)</option>
      <option value="LAB">Laboratorio Químico (LAB)</option>
      <option value="TM">Taller de Molde (TM)</option>
    </select>

    <label>Tipo de Delay</label>
    <select name="tipo" required>
      <option value="">Seleccionar</option>
      <option value="OPE">Operacional</option>
      <option value="ELE">Eléctrico</option>
      <option value="MEC">Mecánico</option>
      <option value="REF">Refractario</option>
      <option value="PRO">Proceso</option>
      <option value="SCR">Chatarra</option>
      <option value="SUP">Proveedores</option>
      <option value="PRE">Preventivo</option>
      <option value="UTI">Utilidades</option>
      <option value="EXT">Externo</option>
      <option value="CON">Consumibles</option>
      <option value="TRA">Transporte</option>
      <option value="HYD">Hidráulico</option>
      <option value="PNE">Neumático</option>
      <option value="PC">Capacitación</option>
      <option value="SYSO">SysO</option>
    </select>

    <label>Duración (HH:MM)</label>
    <input type="time" name="duracion" step="60" required>

    <label>Colada N°</label>
    <input type="number" name="colada" required>

    <label>Equipo</label>
    <input type="text" name="equipo">

    <label>Problema</label>
    <textarea name="problema"></textarea>

    <button type="submit">Registrar Delay</button>
  </form>

  <script>
    // Fecha actual
    const hoy = new Date();
    const fechaLocal = hoy.getFullYear() + "-" +
      String(hoy.getMonth() + 1).padStart(2, "0") + "-" +
      String(hoy.getDate()).padStart(2, "0");
    document.getElementById("fecha").value = fechaLocal;

    // Advertencia si es entre 00:00 y 06:00
    const horaActual = hoy.getHours();
    if (horaActual >= 0 && horaActual < 6) {
      document.getElementById("alertaTurno").textContent =
        "⚠️ Atención: estás registrando entre las 00:00 y las 06:00. Verificá que la fecha corresponda al día real.";
    }

    // Enviar datos al Web App
    document.getElementById("delayForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const formData = new FormData(document.getElementById("delayForm"));

      fetch("https://script.google.com/macros/s/AKfycbyY4htIFYvZ6CUv3-4k7pS4vzU5aHJK-zs708RQVfoMMTz2xJdKHHfyDFKIRlfo6tnOUg/exec", {
        method: "POST",
        body: formData
      })
      .then(response => response.text())
      .then(data => {
        alert(data);
        if (data.includes("✅")) {
          document.getElementById("delayForm").reset();
          document.getElementById("fecha").value = fechaLocal;
        }
      })
      .catch(error => {
        alert("❌ Error al registrar: " + error);
      });
    });
  </script>
</body>
</html>
